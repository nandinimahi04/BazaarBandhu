{"version":3,"file":"node-build.mjs","sources":["../../server/config/database.ts","../../server/routes/ai-chat.ts","../../server/routes/deepseek-chat.ts","../../server/models/Order.ts","../../server/routes/payment.ts","../../server/models/User.ts","../../server/models/Vendor.ts","../../server/models/Supplier.ts","../../server/routes/api.ts","../../server/app.ts","../../server/index.ts","../../server/node-build.ts"],"sourcesContent":["import mongoose from 'mongoose';\r\n\r\nconst connectDB = async () => {\r\n    try {\r\n        const conn = await mongoose.connect(process.env.MONGODB_URI || 'mongodb://localhost:27017/bazaarbandhu');\r\n\r\n        console.log(`MongoDB Connected: ${conn.connection.host}`);\r\n\r\n        // Create indexes\r\n        await createIndexes();\r\n\r\n    } catch (error) {\r\n        console.error('MongoDB connection error:', error);\r\n        process.exit(1);\r\n    }\r\n};\r\n\r\nconst createIndexes = async () => {\r\n    try {\r\n        // Ensure geospatial indexes are created\r\n        const db = mongoose.connection.db;\r\n        if (!db) return;\r\n\r\n        // Create compound indexes for better query performance\r\n        await db.collection('users').createIndex({\r\n            location: '2dsphere'\r\n        });\r\n\r\n        await db.collection('users').createIndex({\r\n            userType: 1,\r\n            isActive: 1,\r\n            'rating.average': -1\r\n        });\r\n\r\n        await db.collection('users').createIndex({\r\n            productCategories: 1,\r\n            'serviceAreas.pincode': 1\r\n        });\r\n\r\n        await db.collection('orders').createIndex({\r\n            vendor: 1,\r\n            placedAt: -1\r\n        });\r\n\r\n        await db.collection('orders').createIndex({\r\n            supplier: 1,\r\n            status: 1\r\n        });\r\n\r\n        console.log('Database indexes created successfully');\r\n\r\n    } catch (error) {\r\n        console.error('Error creating indexes:', error);\r\n    }\r\n};\r\n\r\nexport default connectDB;\r\n","import express from 'express';\r\nimport { OpenAI } from 'openai';\r\nimport 'dotenv/config';\r\n\r\nconst router = express.Router();\r\nconst openai = new OpenAI({ apiKey: process.env.OPENAI_API_KEY });\r\n\r\nrouter.post('/', async (req: any, res: any) => {\r\n    const { message, language = 'hi' } = req.body;\r\n\r\n    if (!message) {\r\n        return res.status(400).json({ error: 'Message is required' });\r\n    }\r\n\r\n    try {\r\n        const chatCompletion = await openai.chat.completions.create({\r\n            messages: [\r\n                {\r\n                    role: 'system',\r\n                    content: `You are BazaarBandhu AI, a helpful assistant for Indian street food vendors and suppliers. \r\n          Help them with checking prices, matching with suppliers, managing stock, and placing orders. \r\n          Respond in ${language}. Keep responses concise, culturally relevant, and helpful.`\r\n                },\r\n                { role: 'user', content: message }\r\n            ],\r\n            model: 'gpt-3.5-turbo',\r\n            temperature: 0.7,\r\n            max_tokens: 500\r\n        });\r\n\r\n        const reply: any = chatCompletion.choices[0].message.content?.trim();\r\n        return res.json({ reply });\r\n\r\n    } catch (error: any) {\r\n        console.error('AI error:', error.message);\r\n\r\n        // Localized error messages\r\n        const localizedErrors: any = {\r\n            hi: \"माफ़ कीजिए, मैं इस समय जवाब नहीं दे पा रहा हूं। कृपया थोड़ी देर बाद फिर से कोशिश करें।\",\r\n            en: \"I'm sorry, I can't respond right now. The AI service is currently unavailable.\",\r\n            mr: \"क्षमस्व, मी सध्या प्रतिसाद देऊ शकत नाही. AI सेवा सध्या उपलब्ध नाही.\",\r\n            gu: \"માફ કરશો, હું અત્યારે જવાબ આપી શકતો નથી. AI સેવા હાલમાં ઉપલબ્ધ નથી.\"\r\n        };\r\n\r\n        let errorMessage = localizedErrors[language] || localizedErrors.en;\r\n\r\n        if (error.message.includes('quota')) {\r\n            errorMessage = language === 'hi'\r\n                ? \"क्षमा करें, AI सेवा अपनी उपयोग सीमा तक पहुँच गई है। कृपया बाद में पुनः प्रयास करें।\"\r\n                : \"I'm sorry, the AI service has reached its usage limit. Please try again later.\";\r\n        }\r\n\r\n        return res.status(500).json({ reply: errorMessage });\r\n    }\r\n});\r\n\r\nexport default router;\r\n","import express from 'express';\r\nimport { spawn } from 'child_process';\r\nimport path from 'path';\r\nimport { fileURLToPath } from 'url';\r\n\r\nconst __filename = fileURLToPath(import.meta.url);\r\nconst __dirname = path.dirname(__filename);\r\nconst router = express.Router();\r\n\r\n// Path to the Python script that will handle the DeepSeek model\r\nconst PYTHON_SCRIPT_PATH = path.join(__dirname, '..', '..', 'deepseek_server.py');\r\n\r\nrouter.post('/', async (req: any, res: any) => {\r\n    const { message, language = 'english' } = req.body;\r\n    try {\r\n\r\n        if (!message) {\r\n            return res.status(400).json({\r\n                error: 'Message is required'\r\n            });\r\n        }\r\n\r\n        // Call the Python script to generate a response using DeepSeek-R1\r\n        const response = await callDeepSeekModel(message, language);\r\n\r\n        return res.json({ response });\r\n    } catch (error: any) {\r\n        console.error('DeepSeek chat error:', error.message);\r\n\r\n        // Provide localized error messages\r\n        const errorMessages: any = {\r\n            english: \"I'm sorry, there was an error processing your request. Please try again later.\",\r\n            hindi: \"माफ़ कीजिए, आपके अनुरोध को संसाधित करने में एक त्रुटि हुई थी। कृपया बाद में पुनः प्रयास करें।\",\r\n            marathi: \"क्षमस्व, आपल्या विनंतीवर प्रक्रिया करताना त्रुटी आली. कृपया नंतर पुन्हा प्रयत्न करा.\",\r\n            gujarati: \"માફ કરશો, તમારી વિનંતી પર પ્રક્રિયા કરવામાં ભૂલ આવી. કૃપા કરીને પછીથી ફરી પ્રયાસ કરો.\"\r\n        };\r\n\r\n        const errorMessage = errorMessages[language.toLowerCase()] || errorMessages.english;\r\n        return res.status(500).json({ error: errorMessage });\r\n    }\r\n});\r\n\r\nasync function callDeepSeekModel(message: string, language: string) {\r\n    return new Promise((resolve, reject) => {\r\n        // Spawn a Python process to run the model\r\n        const pythonProcess = spawn('python', [\r\n            PYTHON_SCRIPT_PATH,\r\n            '--message', message,\r\n            '--language', language\r\n        ]);\r\n\r\n        let responseData = '';\r\n        let errorData = '';\r\n\r\n        // Collect data from stdout\r\n        pythonProcess.stdout.on('data', (data) => {\r\n            responseData += data.toString();\r\n        });\r\n\r\n        // Collect error data from stderr\r\n        pythonProcess.stderr.on('data', (data) => {\r\n            errorData += data.toString();\r\n        });\r\n\r\n        // Handle process completion\r\n        pythonProcess.on('close', (code) => {\r\n            if (code !== 0) {\r\n                console.error(`DeepSeek process exited with code ${code}`);\r\n                console.error(`Error: ${errorData}`);\r\n                reject(new Error(`DeepSeek process failed with code ${code}`));\r\n                return;\r\n            }\r\n\r\n            try {\r\n                // Parse the JSON response from the Python script\r\n                const parsedResponse = JSON.parse(responseData.trim());\r\n                resolve(parsedResponse.response);\r\n            } catch (error) {\r\n                console.error('Failed to parse DeepSeek response:', error);\r\n                console.error('Raw response:', responseData);\r\n                reject(new Error('Failed to parse model response'));\r\n            }\r\n        });\r\n\r\n        // Handle process errors\r\n        pythonProcess.on('error', (error) => {\r\n            console.error('Failed to start DeepSeek process:', error);\r\n            reject(error);\r\n        });\r\n\r\n        // Set a timeout to prevent hanging\r\n        const timeout = setTimeout(() => {\r\n            pythonProcess.kill();\r\n            reject(new Error('DeepSeek process timed out'));\r\n        }, 60000); // 60 second timeout\r\n\r\n        // Clear the timeout when the process completes\r\n        pythonProcess.on('close', () => {\r\n            clearTimeout(timeout);\r\n        });\r\n    });\r\n}\r\n\r\nexport default router;\r\n","import mongoose from 'mongoose';\r\n\r\n// Order Item Schema\r\nconst orderItemSchema = new mongoose.Schema({\r\n    productId: { type: mongoose.Schema.Types.ObjectId, required: true },\r\n    productName: { type: String, required: true },\r\n    category: { type: String, required: true },\r\n    quantity: { type: Number, required: true, min: 1 },\r\n    unit: { type: String, required: true },\r\n    pricePerUnit: { type: Number, required: true },\r\n    totalPrice: { type: Number, required: true },\r\n    quality: { type: String, enum: ['A+', 'A', 'B+', 'B'], default: 'A' },\r\n    specifications: { type: String }, // special requirements\r\n    images: [{ type: String }] // product images at time of order\r\n});\r\n\r\n// Delivery Schema\r\nconst deliverySchema = new mongoose.Schema({\r\n    method: {\r\n        type: String,\r\n        enum: ['self_pickup', 'supplier_delivery', 'third_party'],\r\n        default: 'supplier_delivery'\r\n    },\r\n    address: {\r\n        street: { type: String, required: true },\r\n        city: { type: String, required: true },\r\n        state: { type: String, required: true },\r\n        pincode: { type: String, required: true },\r\n        landmark: { type: String },\r\n        coordinates: {\r\n            type: [Number], // [longitude, latitude]\r\n            index: '2dsphere'\r\n        }\r\n    },\r\n    scheduledDate: { type: Date, required: true },\r\n    timeSlot: {\r\n        from: { type: String, required: true }, // \"09:00\"\r\n        to: { type: String, required: true }     // \"12:00\"\r\n    },\r\n    deliveryCharge: { type: Number, default: 0 },\r\n    estimatedTime: { type: Number }, // in minutes\r\n    actualDeliveryTime: { type: Date },\r\n    deliveryPerson: {\r\n        name: { type: String },\r\n        phone: { type: String },\r\n        vehicleNumber: { type: String },\r\n        photo: { type: String }\r\n    },\r\n    trackingSteps: [{\r\n        status: {\r\n            type: String,\r\n            enum: ['pending', 'confirmed', 'packed', 'dispatched', 'in_transit', 'out_for_delivery', 'delivered', 'failed'],\r\n            required: true\r\n        },\r\n        timestamp: { type: Date, default: Date.now },\r\n        location: { type: String },\r\n        description: { type: String },\r\n        photo: { type: String }\r\n    }],\r\n    deliveryInstructions: { type: String }\r\n});\r\n\r\n// Payment Schema\r\nconst paymentSchema = new mongoose.Schema({\r\n    method: {\r\n        type: String,\r\n        enum: ['cash', 'upi', 'card', 'bank_transfer', 'credit', 'wallet'],\r\n        required: true\r\n    },\r\n    status: {\r\n        type: String,\r\n        enum: ['pending', 'processing', 'completed', 'failed', 'refunded'],\r\n        default: 'pending'\r\n    },\r\n    transactionId: { type: String },\r\n    upiId: { type: String },\r\n    cardLast4: { type: String },\r\n    bankReference: { type: String },\r\n    amount: { type: Number, required: true },\r\n    tax: { type: Number, default: 0 },\r\n    serviceCharge: { type: Number, default: 0 },\r\n    discount: { type: Number, default: 0 },\r\n    finalAmount: { type: Number, required: true },\r\n    paidAt: { type: Date },\r\n    refundAmount: { type: Number, default: 0 },\r\n    refundDate: { type: Date },\r\n    paymentGateway: { type: String },\r\n    gatewayTransactionId: { type: String }\r\n});\r\n\r\n// Main Order Schema\r\nconst orderSchema = new mongoose.Schema({\r\n    // Order Identification\r\n    orderNumber: {\r\n        type: String,\r\n        unique: true,\r\n        required: true,\r\n        default: function (this: any) {\r\n            return 'BB-' + new Date().getFullYear() + '-' +\r\n                Math.random().toString(36).substr(2, 6).toUpperCase();\r\n        }\r\n    },\r\n\r\n    // Parties Involved\r\n    vendor: {\r\n        type: mongoose.Schema.Types.ObjectId,\r\n        ref: 'Vendor',\r\n        required: true\r\n    },\r\n    supplier: {\r\n        type: mongoose.Schema.Types.ObjectId,\r\n        ref: 'Supplier',\r\n        required: true\r\n    },\r\n\r\n    // Order Details\r\n    items: [orderItemSchema],\r\n\r\n    // Pricing\r\n    subtotal: { type: Number, required: true },\r\n    tax: { type: Number, default: 0 },\r\n    deliveryCharge: { type: Number, default: 0 },\r\n    serviceCharge: { type: Number, default: 0 },\r\n    discount: { type: Number, default: 0 },\r\n    totalAmount: { type: Number, required: true },\r\n\r\n    // Savings Information\r\n    marketPrice: { type: Number }, // total if bought at market rates\r\n    savedAmount: { type: Number, default: 0 },\r\n    savingsPercentage: { type: Number, default: 0 },\r\n\r\n    // Order Status\r\n    status: {\r\n        type: String,\r\n        enum: [\r\n            'pending', 'confirmed', 'processing', 'packed',\r\n            'dispatched', 'in_transit', 'delivered',\r\n            'cancelled', 'returned', 'refunded'\r\n        ],\r\n        default: 'pending'\r\n    },\r\n\r\n    // Timing\r\n    placedAt: { type: Date, default: Date.now },\r\n    confirmedAt: { type: Date },\r\n    packedAt: { type: Date },\r\n    dispatchedAt: { type: Date },\r\n    deliveredAt: { type: Date },\r\n    cancelledAt: { type: Date },\r\n\r\n    // Order Type\r\n    orderType: {\r\n        type: String,\r\n        enum: ['instant', 'scheduled', 'recurring', 'group'],\r\n        default: 'instant'\r\n    },\r\n\r\n    // Group Order Details (if applicable)\r\n    groupOrder: {\r\n        groupId: { type: mongoose.Schema.Types.ObjectId, ref: 'Group' },\r\n        isGroupCoordinator: { type: Boolean, default: false },\r\n        groupDiscount: { type: Number, default: 0 }\r\n    },\r\n\r\n    // Recurring Order Details (if applicable)\r\n    recurringOrder: {\r\n        parentOrderId: { type: mongoose.Schema.Types.ObjectId, ref: 'Order' },\r\n        frequency: { type: String, enum: ['daily', 'weekly', 'bi-weekly', 'monthly'] },\r\n        nextOrderDate: { type: Date },\r\n        isAutoGenerated: { type: Boolean, default: false }\r\n    },\r\n\r\n    // Delivery Information\r\n    delivery: deliverySchema,\r\n\r\n    // Payment Information\r\n    payment: paymentSchema,\r\n\r\n    // Special Instructions\r\n    specialInstructions: { type: String },\r\n    vendorNotes: { type: String },\r\n    supplierNotes: { type: String },\r\n\r\n    // Quality & Rating\r\n    rating: {\r\n        vendor: {\r\n            productQuality: { type: Number, min: 1, max: 5 },\r\n            deliverySpeed: { type: Number, min: 1, max: 5 },\r\n            packaging: { type: Number, min: 1, max: 5 },\r\n            overall: { type: Number, min: 1, max: 5 },\r\n            review: { type: String },\r\n            ratedAt: { type: Date }\r\n        },\r\n        supplier: {\r\n            productQuality: { type: Number, min: 1, max: 5 },\r\n            serviceQuality: { type: Number, min: 1, max: 5 },\r\n            pricing: { type: Number, min: 1, max: 5 },\r\n            overall: { type: Number, min: 1, max: 5 },\r\n            review: { type: String },\r\n            ratedAt: { type: Date }\r\n        }\r\n    },\r\n\r\n    // Issues & Support\r\n    issues: [{\r\n        type: {\r\n            type: String,\r\n            enum: ['quality', 'quantity', 'delivery', 'payment', 'other']\r\n        },\r\n        description: { type: String, required: true },\r\n        reportedAt: { type: Date, default: Date.now },\r\n        status: {\r\n            type: String,\r\n            enum: ['open', 'investigating', 'resolved', 'closed'],\r\n            default: 'open'\r\n        },\r\n        resolution: { type: String },\r\n        resolvedAt: { type: Date }\r\n    }],\r\n\r\n    // Cancellation\r\n    cancellation: {\r\n        reason: { type: String },\r\n        cancelledBy: {\r\n            type: String,\r\n            enum: ['vendor', 'supplier', 'system', 'admin']\r\n        },\r\n        refundAmount: { type: Number, default: 0 },\r\n        cancellationCharge: { type: Number, default: 0 }\r\n    },\r\n\r\n    // AI Assistant Interaction\r\n    aiAssistant: {\r\n        wasOrderedByAI: { type: Boolean, default: false },\r\n        voiceCommand: { type: String },\r\n        confidence: { type: Number, min: 0, max: 1 },\r\n        suggestedByAI: { type: Boolean, default: false }\r\n    },\r\n\r\n    // Notifications\r\n    notifications: [{\r\n        type: {\r\n            type: String,\r\n            enum: ['sms', 'email', 'push', 'whatsapp']\r\n        },\r\n        message: { type: String },\r\n        sentAt: { type: Date },\r\n        status: {\r\n            type: String,\r\n            enum: ['sent', 'delivered', 'failed']\r\n        }\r\n    }]\r\n}, {\r\n    timestamps: true\r\n});\r\n\r\n// Indexes\r\norderSchema.index({ vendor: 1, placedAt: -1 });\r\norderSchema.index({ supplier: 1, placedAt: -1 });\r\norderSchema.index({ orderNumber: 1 });\r\norderSchema.index({ status: 1 });\r\norderSchema.index({ 'delivery.scheduledDate': 1 });\r\norderSchema.index({ 'payment.status': 1 });\r\norderSchema.index({ orderType: 1 });\r\n\r\n// Virtual for delivery status\r\norderSchema.virtual('deliveryStatus').get(function (this: any) {\r\n    if (!this.delivery.trackingSteps.length) return 'pending';\r\n    return this.delivery.trackingSteps[this.delivery.trackingSteps.length - 1].status;\r\n});\r\n\r\n// Virtual for estimated delivery time\r\norderSchema.virtual('estimatedDelivery').get(function (this: any) {\r\n    if (this.delivery.scheduledDate && this.delivery.estimatedTime) {\r\n        return new Date(this.delivery.scheduledDate.getTime() + this.delivery.estimatedTime * 60000);\r\n    }\r\n    return null;\r\n});\r\n\r\n// Method to add tracking step\r\norderSchema.methods.addTrackingStep = function (this: any, status: string, location: string, description: string, photo?: string) {\r\n    this.delivery.trackingSteps.push({\r\n        status,\r\n        location,\r\n        description,\r\n        photo,\r\n        timestamp: new Date()\r\n    });\r\n\r\n    // Update order status\r\n    this.status = status;\r\n\r\n    // Set specific timestamps\r\n    const now = new Date();\r\n    switch (status) {\r\n        case 'confirmed':\r\n            this.confirmedAt = now;\r\n            break;\r\n        case 'packed':\r\n            this.packedAt = now;\r\n            break;\r\n        case 'dispatched':\r\n            this.dispatchedAt = now;\r\n            break;\r\n        case 'delivered':\r\n            this.deliveredAt = now;\r\n            break;\r\n    }\r\n\r\n    return this.save();\r\n};\r\n\r\n// Method to calculate total savings\r\norderSchema.methods.calculateSavings = function (this: any) {\r\n    if (this.marketPrice && this.totalAmount) {\r\n        this.savedAmount = this.marketPrice - this.totalAmount;\r\n        this.savingsPercentage = ((this.savedAmount / this.marketPrice) * 100).toFixed(2);\r\n    }\r\n    return this.save();\r\n};\r\n\r\n// Method to send notification\r\norderSchema.methods.sendNotification = function (this: any, type: string, message: string) {\r\n    this.notifications.push({\r\n        type,\r\n        message,\r\n        sentAt: new Date(),\r\n        status: 'sent'\r\n    });\r\n    return this.save();\r\n};\r\n\r\n// Static method to get orders in date range\r\norderSchema.statics.getOrdersInRange = function (startDate: Date, endDate: Date, filters = {}) {\r\n    const query = {\r\n        placedAt: { $gte: startDate, $lte: endDate },\r\n        ...filters\r\n    };\r\n    return this.find(query).populate('vendor supplier');\r\n};\r\n\r\n// Static method to get analytics\r\norderSchema.statics.getAnalytics = function (vendorId: string, period = 'month') {\r\n    const now = new Date();\r\n    let startDate: Date;\r\n\r\n    switch (period) {\r\n        case 'day':\r\n            startDate = new Date(now.setDate(now.getDate() - 1));\r\n            break;\r\n        case 'week':\r\n            startDate = new Date(now.setDate(now.getDate() - 7));\r\n            break;\r\n        case 'month':\r\n            startDate = new Date(now.setMonth(now.getMonth() - 1));\r\n            break;\r\n        case 'year':\r\n            startDate = new Date(now.setFullYear(now.getFullYear() - 1));\r\n            break;\r\n        default:\r\n            startDate = new Date(now.setMonth(now.getMonth() - 1));\r\n    }\r\n\r\n    return this.aggregate([\r\n        { $match: { vendor: new mongoose.Types.ObjectId(vendorId), placedAt: { $gte: startDate } } },\r\n        {\r\n            $group: {\r\n                _id: null,\r\n                totalOrders: { $sum: 1 },\r\n                totalAmount: { $sum: '$totalAmount' },\r\n                totalSavings: { $sum: '$savedAmount' },\r\n                averageOrderValue: { $avg: '$totalAmount' },\r\n                deliveredOrders: {\r\n                    $sum: { $cond: [{ $eq: ['$status', 'delivered'] }, 1, 0] }\r\n                }\r\n            }\r\n        }\r\n    ]);\r\n};\r\n\r\n// Static method to get supplier analytics\r\norderSchema.statics.getSupplierAnalytics = function (supplierId: string, period = 'month') {\r\n    const now = new Date();\r\n    let startDate: Date;\r\n\r\n    switch (period) {\r\n        case 'day':\r\n            startDate = new Date(now.setDate(now.getDate() - 1));\r\n            break;\r\n        case 'week':\r\n            startDate = new Date(now.setDate(now.getDate() - 7));\r\n            break;\r\n        case 'month':\r\n            startDate = new Date(now.setMonth(now.getMonth() - 1));\r\n            break;\r\n        case 'year':\r\n            startDate = new Date(now.setFullYear(now.getFullYear() - 1));\r\n            break;\r\n        default:\r\n            startDate = new Date(now.setMonth(now.getMonth() - 1));\r\n    }\r\n\r\n    return this.aggregate([\r\n        { $match: { supplier: new mongoose.Types.ObjectId(supplierId), placedAt: { $gte: startDate } } },\r\n        {\r\n            $group: {\r\n                _id: null,\r\n                totalOrders: { $sum: 1 },\r\n                totalSales: { $sum: '$totalAmount' },\r\n                totalItemsSold: { $sum: { $size: '$items' } },\r\n                averageOrderValue: { $avg: '$totalAmount' },\r\n                pendingOrders: {\r\n                    $sum: { $cond: [{ $eq: ['$status', 'pending'] }, 1, 0] }\r\n                },\r\n                deliveredOrders: {\r\n                    $sum: { $cond: [{ $eq: ['$status', 'delivered'] }, 1, 0] }\r\n                }\r\n            }\r\n        }\r\n    ]);\r\n};\r\n\r\nconst Order = mongoose.models.Order || mongoose.model('Order', orderSchema);\r\n\r\nexport default Order;\r\n","import express from 'express';\r\nimport Razorpay from 'razorpay';\r\nimport crypto from 'crypto';\r\nimport { createRequire } from 'module';\r\nimport 'dotenv/config';\r\n\r\nconst require = createRequire(import.meta.url);\r\nconst router = express.Router();\r\n// Use require for models to avoid deep conversion if not needed, or use import\r\n// @ts-ignore\r\nimport Order from '../models/Order.js';\r\n\r\nconst razorpay = new Razorpay({\r\n    key_id: process.env.RAZORPAY_KEY_ID || 'rzp_test_5yLzXw7fN4LwXj',\r\n    key_secret: process.env.RAZORPAY_KEY_SECRET || 'secret_key_here'\r\n});\r\n\r\n// Create Razorpay Order\r\nrouter.post('/create-order', async (req: any, res: any) => {\r\n    try {\r\n        const { amount, currency = 'INR', receipt } = req.body;\r\n\r\n        const options = {\r\n            amount: Math.round(amount * 100), // Razorpay expects amount in paise\r\n            currency,\r\n            receipt,\r\n        };\r\n\r\n        const order = await razorpay.orders.create(options);\r\n        res.json(order);\r\n    } catch (error: any) {\r\n        console.error('Razorpay order creation failed:', error);\r\n        res.status(500).json({ error: error.message });\r\n    }\r\n});\r\n\r\n// Verify Payment Signature\r\nrouter.post('/verify', async (req: any, res: any) => {\r\n    try {\r\n        const {\r\n            razorpay_order_id,\r\n            razorpay_payment_id,\r\n            razorpay_signature,\r\n            orderId // MongoDB Order ID\r\n        } = req.body;\r\n\r\n        const shasum = crypto.createHmac('sha256', process.env.RAZORPAY_KEY_SECRET || 'secret_key_here');\r\n        shasum.update(`${razorpay_order_id}|${razorpay_payment_id}`);\r\n        const digest = shasum.digest('hex');\r\n\r\n        if (digest === razorpay_signature) {\r\n            // Payment is verified\r\n            if (orderId) {\r\n                await Order.findByIdAndUpdate(orderId, {\r\n                    'payment.status': 'completed',\r\n                    'payment.transactionId': razorpay_payment_id,\r\n                    'payment.gatewayTransactionId': razorpay_order_id,\r\n                    'status': 'confirmed'\r\n                });\r\n            }\r\n            res.json({ status: 'success' });\r\n        } else {\r\n            res.status(400).json({ status: 'failure', message: 'Signature verification failed' });\r\n        }\r\n    } catch (error: any) {\r\n        console.error('Razorpay verification failed:', error);\r\n        res.status(500).json({ error: error.message });\r\n    }\r\n});\r\n\r\nexport default router;\r\n","import mongoose from 'mongoose';\r\n\r\n// Address Schema\r\nconst addressSchema = new mongoose.Schema({\r\n    street: { type: String, required: true },\r\n    city: { type: String, required: true },\r\n    state: { type: String, required: true },\r\n    pincode: { type: String, required: true },\r\n    country: { type: String, default: 'India' }\r\n});\r\n\r\n// Working Hours Schema\r\nconst workingHoursSchema = new mongoose.Schema({\r\n    from: { type: String, required: true }, // Format: \"06:00\"\r\n    to: { type: String, required: true }    // Format: \"20:00\"\r\n});\r\n\r\n// Location Schema for geographic features\r\nconst locationSchema = new mongoose.Schema({\r\n    type: {\r\n        type: String,\r\n        enum: ['Point']\r\n    },\r\n    coordinates: {\r\n        type: [Number], // [longitude, latitude]\r\n        required: true,\r\n        default: undefined\r\n    }\r\n});\r\n\r\n// Base User Schema\r\nconst userSchema = new mongoose.Schema({\r\n    // Basic Information\r\n    fullName: { type: String, required: true },\r\n    email: { type: String, required: true, unique: true },\r\n    password: { type: String, required: true },\r\n    phone: { type: String, required: true },\r\n    userType: {\r\n        type: String,\r\n        required: true,\r\n        enum: ['vendor', 'supplier', 'admin']\r\n    },\r\n\r\n    // Business Information\r\n    businessName: { type: String, required: true },\r\n    businessType: { type: String },\r\n\r\n    // Address\r\n    address: addressSchema,\r\n    location: {\r\n        type: locationSchema,\r\n        index: '2dsphere'\r\n    },\r\n\r\n    // Account Status\r\n    isActive: { type: Boolean, default: true },\r\n    isVerified: { type: Boolean, default: false },\r\n    emailVerified: { type: Boolean, default: false },\r\n    phoneVerified: { type: Boolean, default: false },\r\n\r\n    // Profile\r\n    profileImage: { type: String },\r\n    language: {\r\n        type: String,\r\n        enum: ['hi', 'en', 'mr', 'gu', 'ta', 'te', 'kn', 'bn'],\r\n        default: 'hi'\r\n    },\r\n\r\n    // Ratings and Reviews\r\n    rating: {\r\n        average: { type: Number, default: 0, min: 0, max: 5 },\r\n        count: { type: Number, default: 0 }\r\n    },\r\n\r\n    // Trust Score\r\n    trustScore: { type: Number, default: 0, min: 0, max: 100 },\r\n\r\n    // Financial\r\n    totalSavings: { type: Number, default: 0 },\r\n    totalOrders: { type: Number, default: 0 },\r\n    totalSpent: { type: Number, default: 0 },\r\n\r\n    // Group/Network\r\n    groupMembers: [{\r\n        type: mongoose.Schema.Types.ObjectId,\r\n        ref: 'User'\r\n    }],\r\n\r\n    // Timestamps\r\n    lastLogin: { type: Date },\r\n    registrationDate: { type: Date, default: Date.now }\r\n}, {\r\n    timestamps: true,\r\n    discriminatorKey: 'userType'\r\n});\r\n\r\n// Indexes\r\nuserSchema.index({ email: 1 });\r\nuserSchema.index({ phone: 1 });\r\nuserSchema.index({ userType: 1 });\r\nuserSchema.index({ 'location': '2dsphere' });\r\nuserSchema.index({ businessName: 'text', fullName: 'text' });\r\n\r\nconst User = mongoose.models.User || mongoose.model('User', userSchema);\r\n\r\nexport default User;\r\n","import mongoose from 'mongoose';\r\n// @ts-ignore\r\nimport User from './User.js';\r\n\r\n// Vendor-specific schema using discriminator\r\nconst vendorSchema = new mongoose.Schema({\r\n    // Business Type & Category\r\n    businessCategory: {\r\n        type: String,\r\n        enum: ['street_food', 'restaurant', 'cafe', 'catering', 'retail', 'wholesale'],\r\n        required: true\r\n    },\r\n    businessSize: {\r\n        type: String,\r\n        enum: ['small', 'medium', 'large'],\r\n        default: 'small'\r\n    },\r\n\r\n    // Purchasing Patterns\r\n    averageMonthlyPurchase: { type: Number, default: 0 },\r\n    preferredPaymentMethod: {\r\n        type: String,\r\n        enum: ['Cash', 'UPI', 'Credit', 'Bank Transfer'],\r\n        default: 'UPI'\r\n    },\r\n\r\n    // Credit Information\r\n    creditLimit: { type: Number, default: 5000 },\r\n    currentCredit: { type: Number, default: 0 },\r\n    creditScore: { type: Number, default: 100, min: 0, max: 1000 },\r\n\r\n    // Preferred Suppliers\r\n    preferredSuppliers: [{\r\n        supplierId: { type: mongoose.Schema.Types.ObjectId, ref: 'Supplier' },\r\n        preferenceScore: { type: Number, min: 1, max: 10, default: 5 },\r\n        lastOrderDate: { type: Date },\r\n        totalOrderValue: { type: Number, default: 0 }\r\n    }],\r\n\r\n    // Inventory Management\r\n    currentInventory: [{\r\n        productName: { type: String, required: true },\r\n        category: { type: String, required: true },\r\n        quantity: { type: Number, required: true },\r\n        unit: { type: String, required: true },\r\n        purchaseDate: { type: Date, default: Date.now },\r\n        expiryDate: { type: Date },\r\n        costPrice: { type: Number },\r\n        supplier: { type: mongoose.Schema.Types.ObjectId, ref: 'Supplier' }\r\n    }],\r\n\r\n    // Regular Orders & Subscriptions\r\n    recurringOrders: [{\r\n        productName: { type: String, required: true },\r\n        quantity: { type: Number, required: true },\r\n        unit: { type: String, required: true },\r\n        frequency: {\r\n            type: String,\r\n            enum: ['daily', 'weekly', 'bi-weekly', 'monthly'],\r\n            required: true\r\n        },\r\n        nextDeliveryDate: { type: Date },\r\n        preferredSupplier: { type: mongoose.Schema.Types.ObjectId, ref: 'Supplier' },\r\n        isActive: { type: Boolean, default: true },\r\n        maxPrice: { type: Number } // auto-cancel if price exceeds this\r\n    }],\r\n\r\n    // Purchase History & Analytics\r\n    purchaseAnalytics: {\r\n        totalPurchases: { type: Number, default: 0 },\r\n        totalAmount: { type: Number, default: 0 },\r\n        averageOrderValue: { type: Number, default: 0 },\r\n        mostOrderedCategory: { type: String },\r\n        peakOrderingHours: [{ type: Number, min: 0, max: 23 }],\r\n        seasonalTrends: [{\r\n            month: { type: Number, min: 1, max: 12 },\r\n            averageSpending: { type: Number }\r\n        }]\r\n    },\r\n\r\n    // Group Buying\r\n    groupBuying: {\r\n        isParticipating: { type: Boolean, default: false },\r\n        groupId: { type: mongoose.Schema.Types.ObjectId, ref: 'Group' },\r\n        role: { type: String, enum: ['member', 'coordinator'], default: 'member' },\r\n        contributionScore: { type: Number, default: 0 }\r\n    },\r\n\r\n    // Preferences & Settings\r\n    preferences: {\r\n        preferredDeliveryTime: {\r\n            from: { type: String, default: '09:00' },\r\n            to: { type: String, default: '18:00' }\r\n        },\r\n        qualityPreference: { type: String, enum: ['A+', 'A', 'B+', 'B'], default: 'A' },\r\n        priceVsQuality: { type: String, enum: ['price', 'quality', 'balanced'], default: 'balanced' },\r\n        notificationPreferences: {\r\n            sms: { type: Boolean, default: true },\r\n            email: { type: Boolean, default: true },\r\n            whatsapp: { type: Boolean, default: false },\r\n            push: { type: Boolean, default: true }\r\n        },\r\n        autoReorderSettings: {\r\n            enabled: { type: Boolean, default: false },\r\n            thresholdDays: { type: Number, default: 3 }\r\n        }\r\n    },\r\n\r\n    // Financial Metrics\r\n    savings: {\r\n        totalSaved: { type: Number, default: 0 },\r\n        lastMonthSavings: { type: Number, default: 0 },\r\n        savingsBreakdown: [{\r\n            category: { type: String },\r\n            amount: { type: Number },\r\n            percentage: { type: Number }\r\n        }]\r\n    },\r\n\r\n    // Loyalty & Rewards\r\n    loyaltyPoints: { type: Number, default: 0 },\r\n    rewardsEarned: [{\r\n        type: { type: String },\r\n        points: { type: Number },\r\n        date: { type: Date, default: Date.now },\r\n        description: { type: String }\r\n    }],\r\n\r\n    // AI Assistant Preferences\r\n    aiAssistant: {\r\n        isEnabled: { type: Boolean, default: true },\r\n        preferredLanguage: { type: String, default: 'hi' },\r\n        autoSuggestions: { type: Boolean, default: true },\r\n        voiceCommands: { type: Boolean, default: true },\r\n        learningFromHistory: { type: Boolean, default: true }\r\n    },\r\n\r\n    // Emergency Contacts\r\n    emergencyContacts: [{\r\n        name: { type: String, required: true },\r\n        phone: { type: String, required: true },\r\n        relationship: { type: String, required: true }\r\n    }],\r\n\r\n    // Compliance & Documentation\r\n    documents: [{\r\n        type: { type: String, enum: ['license', 'permit', 'certificate', 'registration'] },\r\n        name: { type: String, required: true },\r\n        documentNumber: { type: String },\r\n        issueDate: { type: Date },\r\n        expiryDate: { type: Date },\r\n        fileUrl: { type: String },\r\n        isVerified: { type: Boolean, default: false }\r\n    }]\r\n});\r\n\r\n// Indexes for vendors\r\nvendorSchema.index({ businessCategory: 1 });\r\nvendorSchema.index({ creditScore: 1 });\r\nvendorSchema.index({ 'preferredSuppliers.supplierId': 1 });\r\nvendorSchema.index({ 'currentInventory.category': 1 });\r\nvendorSchema.index({ 'recurringOrders.nextDeliveryDate': 1 });\r\n\r\n// Virtual for available credit\r\nvendorSchema.virtual('availableCredit').get(function (this: any) {\r\n    return this.creditLimit - this.currentCredit;\r\n});\r\n\r\n// Virtual for inventory value\r\nvendorSchema.virtual('totalInventoryValue').get(function (this: any) {\r\n    return this.currentInventory.reduce((total: number, item: any) => {\r\n        return total + ((item.costPrice || 0) * item.quantity);\r\n    }, 0);\r\n});\r\n\r\n// Method to check low stock items\r\nvendorSchema.methods.getLowStockItems = function (this: any) {\r\n    // Define minimum thresholds based on business category\r\n    const thresholds: any = {\r\n        street_food: 2,\r\n        restaurant: 5,\r\n        cafe: 3,\r\n        catering: 10,\r\n        retail: 20,\r\n        wholesale: 50\r\n    };\r\n\r\n    const threshold = thresholds[this.businessCategory] || 5;\r\n\r\n    return this.currentInventory.filter((item: any) => item.quantity < threshold);\r\n};\r\n\r\n// Method to calculate monthly spending\r\nvendorSchema.methods.getMonthlySpending = function (this: any, month: number) {\r\n    return this.purchaseAnalytics.seasonalTrends.find(\r\n        (trend: any) => trend.month === month\r\n    )?.averageSpending || 0;\r\n};\r\n\r\n// Method to update loyalty points\r\nvendorSchema.methods.addLoyaltyPoints = function (this: any, points: number, description: string) {\r\n    this.loyaltyPoints += points;\r\n    this.rewardsEarned.push({\r\n        type: 'points',\r\n        points: points,\r\n        description: description\r\n    });\r\n    return this.save();\r\n};\r\n\r\n// Method to get purchase recommendations\r\nvendorSchema.methods.getPurchaseRecommendations = function (this: any) {\r\n    const recommendations: any[] = [];\r\n\r\n    // Based on low stock\r\n    const lowStock = this.getLowStockItems();\r\n    lowStock.forEach((item: any) => {\r\n        recommendations.push({\r\n            type: 'restock',\r\n            product: item.productName,\r\n            urgency: 'high',\r\n            reason: 'Low stock'\r\n        });\r\n    });\r\n\r\n    // Based on recurring orders\r\n    const upcomingOrders = this.recurringOrders.filter((order: any) =>\r\n        order.isActive &&\r\n        order.nextDeliveryDate <= new Date(Date.now() + 2 * 24 * 60 * 60 * 1000) // 2 days\r\n    );\r\n\r\n    upcomingOrders.forEach((order: any) => {\r\n        recommendations.push({\r\n            type: 'recurring',\r\n            product: order.productName,\r\n            quantity: order.quantity,\r\n            urgency: 'medium',\r\n            reason: 'Scheduled recurring order'\r\n        });\r\n    });\r\n\r\n    return recommendations;\r\n};\r\n\r\nconst Vendor = mongoose.models.Vendor || User.discriminator('vendor', vendorSchema);\r\n\r\nexport default Vendor;\r\n","import mongoose from 'mongoose';\r\n// @ts-ignore\r\nimport User from './User.js';\r\n\r\n// Supplier-specific schema using discriminator\r\nconst supplierSchema = new mongoose.Schema({\r\n    // Business Details\r\n    productCategories: [{\r\n        type: String,\r\n        enum: ['Vegetables', 'Fruits', 'Spices', 'Grains', 'Dairy', 'Meat', 'Dry Goods', 'Beverages'],\r\n        required: true\r\n    }],\r\n\r\n    // Delivery & Service\r\n    deliveryRadius: { type: Number, required: true, min: 1, max: 100 }, // in km\r\n    minOrderAmount: { type: Number, required: true, min: 0 },\r\n    maxOrderCapacity: { type: Number, default: 10000 }, // daily capacity in units\r\n\r\n    // Payment Methods\r\n    paymentMethods: [{\r\n        type: String,\r\n        enum: ['Cash', 'UPI', 'Credit', 'Bank Transfer', 'Cheque'],\r\n        required: true\r\n    }],\r\n\r\n    // Working Schedule\r\n    workingHours: {\r\n        from: { type: String, required: true },\r\n        to: { type: String, required: true }\r\n    },\r\n    workingDays: [{\r\n        type: String,\r\n        enum: ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'],\r\n        default: ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday']\r\n    }],\r\n\r\n    // Legal & Compliance\r\n    gstNumber: {\r\n        type: String,\r\n        validate: {\r\n            validator: function (v: string) {\r\n                return !v || /^[0-9]{2}[A-Z]{5}[0-9]{4}[A-Z]{1}[1-9A-Z]{1}Z[0-9A-Z]{1}$/.test(v);\r\n            },\r\n            message: 'Invalid GST number format'\r\n        }\r\n    },\r\n    fssaiLicense: { type: String },\r\n    panNumber: { type: String },\r\n\r\n    // Bank Details\r\n    bankDetails: {\r\n        accountNumber: { type: String },\r\n        ifscCode: { type: String },\r\n        bankName: { type: String },\r\n        accountHolderName: { type: String }\r\n    },\r\n\r\n    // Inventory & Products\r\n    products: [{\r\n        name: { type: String, required: true },\r\n        category: { type: String, required: true },\r\n        unit: { type: String, required: true }, // kg, litre, piece, etc.\r\n        pricePerUnit: { type: Number, required: true },\r\n        currentStock: { type: Number, default: 0 },\r\n        minStock: { type: Number, default: 10 },\r\n        maxStock: { type: Number, default: 1000 },\r\n        quality: { type: String, enum: ['A+', 'A', 'B+', 'B'], default: 'A' },\r\n        description: { type: String },\r\n        images: [{ type: String }],\r\n        isActive: { type: Boolean, default: true }\r\n    }],\r\n\r\n    // Performance Metrics\r\n    metrics: {\r\n        totalDeliveries: { type: Number, default: 0 },\r\n        onTimeDeliveries: { type: Number, default: 0 },\r\n        totalRevenue: { type: Number, default: 0 },\r\n        averageOrderValue: { type: Number, default: 0 },\r\n        cancellationRate: { type: Number, default: 0 },\r\n        returnRate: { type: Number, default: 0 }\r\n    },\r\n\r\n    // Verification Status\r\n    verificationStatus: {\r\n        documents: { type: Boolean, default: false },\r\n        address: { type: Boolean, default: false },\r\n        bank: { type: Boolean, default: false },\r\n        quality: { type: Boolean, default: false }\r\n    },\r\n\r\n    // Service Areas\r\n    serviceAreas: [{\r\n        pincode: { type: String, required: true },\r\n        deliveryCharge: { type: Number, default: 0 },\r\n        minimumOrderForFreeDelivery: { type: Number, default: 500 }\r\n    }],\r\n\r\n    // Subscription & Plans\r\n    subscriptionPlan: {\r\n        type: { type: String, enum: ['basic', 'premium', 'enterprise'], default: 'basic' },\r\n        startDate: { type: Date },\r\n        endDate: { type: Date },\r\n        features: [{ type: String }]\r\n    },\r\n\r\n    // Special Offerings\r\n    specialOffers: [{\r\n        title: { type: String },\r\n        description: { type: String },\r\n        discountPercentage: { type: Number, min: 0, max: 100 },\r\n        validFrom: { type: Date },\r\n        validTo: { type: Date },\r\n        isActive: { type: Boolean, default: true }\r\n    }],\r\n\r\n    // Seasonal Availability\r\n    seasonalProducts: [{\r\n        productName: { type: String },\r\n        availableMonths: [{ type: Number, min: 1, max: 12 }],\r\n        peakMonths: [{ type: Number, min: 1, max: 12 }]\r\n    }]\r\n});\r\n\r\n// Indexes for suppliers\r\nsupplierSchema.index({ productCategories: 1 });\r\nsupplierSchema.index({ deliveryRadius: 1 });\r\nsupplierSchema.index({ 'products.category': 1 });\r\nsupplierSchema.index({ 'products.pricePerUnit': 1 });\r\nsupplierSchema.index({ 'serviceAreas.pincode': 1 });\r\nsupplierSchema.index({ 'verificationStatus.documents': 1 });\r\n\r\n// Virtual for delivery success rate\r\nsupplierSchema.virtual('deliverySuccessRate').get(function (this: any) {\r\n    if (this.metrics.totalDeliveries === 0) return 0;\r\n    return ((this.metrics.onTimeDeliveries / this.metrics.totalDeliveries) * 100).toFixed(1);\r\n});\r\n\r\n// Method to check if supplier serves a particular area\r\nsupplierSchema.methods.servesArea = function (this: any, pincode: string) {\r\n    return this.serviceAreas.some((area: any) => area.pincode === pincode);\r\n};\r\n\r\n// Method to get available products\r\nsupplierSchema.methods.getAvailableProducts = function (this: any) {\r\n    return this.products.filter((product: any) =>\r\n        product.isActive && product.currentStock > product.minStock\r\n    );\r\n};\r\n\r\n// Method to update stock\r\nsupplierSchema.methods.updateStock = function (this: any, productId: string, quantity: number, operation = 'subtract') {\r\n    const product = this.products.id(productId);\r\n    if (product) {\r\n        if (operation === 'subtract') {\r\n            product.currentStock = Math.max(0, product.currentStock - quantity);\r\n        } else {\r\n            product.currentStock += quantity;\r\n        }\r\n        return this.save();\r\n    }\r\n    throw new Error('Product not found');\r\n};\r\n\r\nconst Supplier = mongoose.models.Supplier || User.discriminator('supplier', supplierSchema);\r\n\r\nexport default Supplier;\r\n","import express from 'express';\r\nimport mongoose from 'mongoose';\r\nimport bcrypt from 'bcryptjs';\r\nimport jwt from 'jsonwebtoken';\r\nconst router = express.Router();\r\nimport aiChatRoutes from './ai-chat.js';\r\nimport deepSeekChatRoutes from './deepseek-chat.js';\r\nimport paymentRoutes from './payment.js';\r\n\r\n// @ts-ignore\r\nimport User from '../models/User.js';\r\n// @ts-ignore\r\nimport Vendor from '../models/Vendor.js';\r\n// @ts-ignore\r\nimport Supplier from '../models/Supplier.js';\r\n// @ts-ignore\r\nimport Order from '../models/Order.js';\r\nimport multer from 'multer';\r\nimport { v2 as cloudinary } from 'cloudinary';\r\nimport { CloudinaryStorage } from 'multer-storage-cloudinary';\r\n\r\n// Configure Cloudinary\r\ncloudinary.config({\r\n    cloud_name: process.env.CLOUDINARY_CLOUD_NAME,\r\n    api_key: process.env.CLOUDINARY_API_KEY,\r\n    api_secret: process.env.CLOUDINARY_API_SECRET\r\n});\r\n\r\n// Configure Multer Storage for Cloudinary\r\nconst storage = new CloudinaryStorage({\r\n    cloudinary: cloudinary,\r\n    params: {\r\n        // @ts-ignore\r\n        folder: 'bazaarbandhu_documents',\r\n        allowed_formats: ['jpg', 'png', 'pdf', 'jpeg'],\r\n        public_id: (req: any, file: any) => `doc_${Date.now()}_${file.originalname.split('.')[0]}`\r\n    }\r\n});\r\n\r\nconst upload = multer({ storage: storage });\r\n\r\n// Middleware for authentication\r\nconst authenticateToken = (req: any, res: any, next: any) => {\r\n    const authHeader = req.headers['authorization'];\r\n    const token = authHeader && authHeader.split(' ')[1];\r\n\r\n    if (!token) {\r\n        return res.status(401).json({ error: 'Access token required' });\r\n    }\r\n\r\n    jwt.verify(token, process.env.JWT_SECRET || 'bazaarbandhu_secret', (err: any, user: any) => {\r\n        if (err) {\r\n            return res.status(403).json({ error: 'Invalid token' });\r\n        }\r\n        req.user = user;\r\n        next();\r\n    });\r\n};\r\n\r\n// ===============================\r\n// AUTHENTICATION ROUTES\r\n// ===============================\r\n\r\n// Upload shop verification document\r\nrouter.post('/upload/document', upload.single('document'), async (req: any, res: any) => {\r\n    try {\r\n        if (!req.file) {\r\n            return res.status(400).json({ error: 'No file uploaded' });\r\n        }\r\n\r\n        res.json({\r\n            message: 'Document uploaded successfully',\r\n            url: req.file.path, // Cloudinary secure URL\r\n            originalName: req.file.originalname\r\n        });\r\n    } catch (error: any) {\r\n        console.error('Upload error:', error);\r\n        res.status(500).json({ error: 'Failed to upload document', details: error.message });\r\n    }\r\n});\r\n\r\n// Register new user (vendor or supplier)\r\nrouter.post('/auth/register', async (req: any, res: any) => {\r\n    try {\r\n        const {\r\n            fullName,\r\n            email,\r\n            password,\r\n            phone,\r\n            userType,\r\n            businessName,\r\n            address,\r\n            addressDetails, // street, city, state, pincode\r\n            // Supplier specific fields\r\n            productCategories,\r\n            deliveryRadius,\r\n            minOrderAmount,\r\n            paymentMethods,\r\n            workingHoursFrom,\r\n            workingHoursTo,\r\n            gstNumber,\r\n            fssaiLicense,\r\n            // Vendor specific fields\r\n            businessCategory,\r\n            stallName, // frontend alias\r\n            stallType  // frontend alias\r\n        } = req.body;\r\n\r\n        // Validate required fields\r\n        if (!fullName || !email || !password || !phone || !userType) {\r\n            return res.status(400).json({\r\n                error: 'Missing required fields: fullName, email, password, phone, userType'\r\n            });\r\n        }\r\n\r\n        // Check if user already exists\r\n        const existingUser = await User.findOne({ email });\r\n        if (existingUser) {\r\n            return res.status(400).json({\r\n                error: 'User with this email already exists'\r\n            });\r\n        }\r\n\r\n        // Hash password\r\n        const saltRounds = 10;\r\n        const hashedPassword = await bcrypt.hash(password, saltRounds);\r\n\r\n        // Prepare address object\r\n        const finalAddress = addressDetails || address || {\r\n            street: 'Not specified',\r\n            city: 'Not specified',\r\n            state: 'Not specified',\r\n            pincode: '000000'\r\n        };\r\n\r\n        // Prepare default location\r\n        const finalLocation = {\r\n            type: 'Point',\r\n            coordinates: [72.8777, 19.0760] // Mumbai coordinates\r\n        };\r\n\r\n        // Create user based on type\r\n        let newUser;\r\n\r\n        if (userType === 'vendor') {\r\n            newUser = new Vendor({\r\n                fullName,\r\n                email,\r\n                password: hashedPassword,\r\n                phone,\r\n                userType,\r\n                businessName: businessName || stallName || 'My Vendor Shop',\r\n                address: finalAddress,\r\n                location: finalLocation,\r\n                businessCategory: businessCategory || stallType || 'street_food'\r\n            });\r\n        } else if (userType === 'supplier') {\r\n            newUser = new Supplier({\r\n                fullName,\r\n                email,\r\n                password: hashedPassword,\r\n                phone,\r\n                userType,\r\n                businessName: businessName || 'My Supplier Business',\r\n                address: finalAddress,\r\n                location: finalLocation,\r\n                productCategories: productCategories || ['Vegetables'],\r\n                deliveryRadius: deliveryRadius || 10,\r\n                minOrderAmount: minOrderAmount || 500,\r\n                paymentMethods: paymentMethods || ['Cash', 'UPI'],\r\n                workingHours: {\r\n                    from: workingHoursFrom || '06:00',\r\n                    to: workingHoursTo || '20:00'\r\n                },\r\n                gstNumber,\r\n                fssaiLicense\r\n            });\r\n        } else {\r\n            return res.status(400).json({\r\n                error: 'Invalid user type'\r\n            });\r\n        }\r\n\r\n        try {\r\n            await newUser.save();\r\n        } catch (saveError) {\r\n            console.error('[AUTH] Save error:', saveError);\r\n            throw saveError;\r\n        }\r\n\r\n        // Generate JWT token\r\n        const token = jwt.sign(\r\n            { userId: newUser._id, email: newUser.email, userType: newUser.userType },\r\n            process.env.JWT_SECRET || 'bazaarbandhu_secret',\r\n            { expiresIn: '7d' }\r\n        );\r\n\r\n        res.status(201).json({\r\n            message: 'User registered successfully',\r\n            token,\r\n            user: {\r\n                id: newUser._id,\r\n                fullName: newUser.fullName,\r\n                email: newUser.email,\r\n                userType: newUser.userType,\r\n                businessName: newUser.businessName\r\n            }\r\n        });\r\n\r\n    } catch (error: any) {\r\n        console.error('[AUTH] Registration error:', error);\r\n\r\n        // Handle Mongoose validation errors\r\n        if (error.name === 'ValidationError') {\r\n            const messages = Object.values(error.errors).map((err: any) => err.message);\r\n            return res.status(400).json({\r\n                error: 'Validation failed',\r\n                details: messages\r\n            });\r\n        }\r\n\r\n        res.status(500).json({\r\n            error: 'Registration failed',\r\n            details: error.message\r\n        });\r\n    }\r\n});\r\n\r\n// Health check for DB\r\nrouter.get('/db-health', (req: any, res: any) => {\r\n    const status = mongoose.connection.readyState;\r\n    const states: { [key: number]: string } = {\r\n        0: 'disconnected',\r\n        1: 'connected',\r\n        2: 'connecting',\r\n        3: 'disconnecting'\r\n    };\r\n    res.json({\r\n        status: states[status] || 'unknown',\r\n        mongodb_uri: process.env.MONGODB_URI ? 'Defined' : 'Missing',\r\n        database: mongoose.connection.name\r\n    });\r\n});\r\n\r\n// Login user\r\nrouter.post('/auth/login', async (req: any, res: any) => {\r\n    try {\r\n        const { email, password } = req.body;\r\n\r\n        if (!email || !password) {\r\n            return res.status(400).json({\r\n                error: 'Email and password required'\r\n            });\r\n        }\r\n\r\n        // Find user by email\r\n        const user = await User.findOne({ email });\r\n        if (!user) {\r\n            return res.status(401).json({\r\n                error: 'Invalid credentials. User not found.'\r\n            });\r\n        }\r\n\r\n        // Check password\r\n        const isValidPassword = await bcrypt.compare(password, user.password);\r\n        if (!isValidPassword) {\r\n            return res.status(401).json({\r\n                error: 'Invalid credentials. Incorrect password.'\r\n            });\r\n        }\r\n\r\n        // Update last login\r\n        user.lastLogin = new Date();\r\n        await user.save();\r\n\r\n        // Generate JWT token\r\n        const token = jwt.sign(\r\n            {\r\n                userId: user._id,\r\n                email: user.email,\r\n                userType: user.userType\r\n            },\r\n            process.env.JWT_SECRET || 'bazaarbandhu_secret',\r\n            { expiresIn: '7d' }\r\n        );\r\n\r\n        res.json({\r\n            message: 'Login successful',\r\n            token,\r\n            user: {\r\n                id: user._id,\r\n                fullName: user.fullName,\r\n                email: user.email,\r\n                userType: user.userType,\r\n                businessName: user.businessName\r\n            }\r\n        });\r\n\r\n    } catch (error: any) {\r\n        console.error('Login error:', error);\r\n        res.status(500).json({\r\n            error: 'Login failed',\r\n            details: error.message\r\n        });\r\n    }\r\n});\r\n\r\n// ===============================\r\n// CONFIG & SYSTEM ROUTES\r\n// ===============================\r\n\r\n// Get dynamic header status line\r\nrouter.get('/config/status-line', (req: any, res: any) => {\r\n    // In a real app, this could depend on market hours, user level, or special events\r\n    const hour = new Date().getHours();\r\n    let statusKey = 'market_open';\r\n\r\n    if (hour < 6 || hour > 21) {\r\n        statusKey = 'market_closed';\r\n    } else if (hour >= 6 && hour < 9) {\r\n        statusKey = 'early_morning';\r\n    } else if (hour >= 18 && hour < 21) {\r\n        statusKey = 'evening_rush';\r\n    }\r\n\r\n    res.json({\r\n        statusKey,\r\n        lastUpdate: new Date(),\r\n        marketStatus: hour >= 6 && hour <= 21 ? 'active' : 'inactive'\r\n    });\r\n});\r\n\r\n// ===============================\r\n// SUPPLIER ROUTES\r\n// ===============================\r\n\r\n// Get all suppliers\r\nrouter.get('/suppliers', async (req: any, res: any) => {\r\n    try {\r\n        const {\r\n            category,\r\n            pincode,\r\n            radius,\r\n            minRating,\r\n            limit = 20,\r\n            page = 1\r\n        } = req.query;\r\n\r\n        let query: any = { userType: 'supplier', isActive: true };\r\n\r\n        // Filter by product category\r\n        if (category) {\r\n            query.productCategories = { $in: [category] };\r\n        }\r\n\r\n        // Filter by rating\r\n        if (minRating) {\r\n            query['rating.average'] = { $gte: parseFloat(minRating as string) };\r\n        }\r\n\r\n        const suppliers = await Supplier.find(query)\r\n            .select('-password')\r\n            .limit(parseInt(limit as string))\r\n            .skip((parseInt(page as string) - 1) * parseInt(limit as string))\r\n            .sort({ 'rating.average': -1, trustScore: -1 });\r\n\r\n        res.json({\r\n            suppliers,\r\n            pagination: {\r\n                page: parseInt(page as string),\r\n                limit: parseInt(limit as string),\r\n                total: await Supplier.countDocuments(query)\r\n            }\r\n        });\r\n\r\n    } catch (error: any) {\r\n        console.error('Get suppliers error:', error);\r\n        res.status(500).json({\r\n            error: 'Failed to fetch suppliers',\r\n            details: error.message\r\n        });\r\n    }\r\n});\r\n\r\n// Get supplier by ID\r\nrouter.get('/suppliers/:id', async (req: any, res: any) => {\r\n    try {\r\n        const supplier = await Supplier.findById(req.params.id)\r\n            .select('-password')\r\n            .populate('groupMembers', 'fullName businessName');\r\n\r\n        if (!supplier) {\r\n            return res.status(404).json({ error: 'Supplier not found' });\r\n        }\r\n\r\n        res.json(supplier);\r\n\r\n    } catch (error: any) {\r\n        console.error('Get supplier error:', error);\r\n        res.status(500).json({\r\n            error: 'Failed to fetch supplier',\r\n            details: error.message\r\n        });\r\n    }\r\n});\r\n\r\n// Get supplier profile\r\nrouter.get('/suppliers/profile', authenticateToken, async (req: any, res: any) => {\r\n    try {\r\n        if (req.user.userType !== 'supplier') {\r\n            return res.status(403).json({\r\n                error: 'Access denied. Suppliers only.'\r\n            });\r\n        }\r\n\r\n        const supplier = await Supplier.findById(req.user.userId)\r\n            .select('-password');\r\n\r\n        if (!supplier) {\r\n            return res.status(404).json({ error: 'Supplier not found' });\r\n        }\r\n\r\n        res.json(supplier);\r\n\r\n    } catch (error: any) {\r\n        console.error('Get supplier profile error:', error);\r\n        res.status(500).json({\r\n            error: 'Failed to fetch profile',\r\n            details: error.message\r\n        });\r\n    }\r\n});\r\n\r\n// Update supplier profile\r\nrouter.put('/suppliers/profile', authenticateToken, async (req: any, res: any) => {\r\n    try {\r\n        if (req.user.userType !== 'supplier') {\r\n            return res.status(403).json({\r\n                error: 'Access denied. Suppliers only.'\r\n            });\r\n        }\r\n\r\n        const updates = req.body;\r\n        delete updates.password; // Prevent password updates through this route\r\n\r\n        const supplier = await Supplier.findByIdAndUpdate(\r\n            req.user.userId,\r\n            { $set: updates },\r\n            { new: true, runValidators: true }\r\n        ).select('-password');\r\n\r\n        if (!supplier) {\r\n            return res.status(404).json({ error: 'Supplier not found' });\r\n        }\r\n\r\n        res.json({\r\n            message: 'Profile updated successfully',\r\n            supplier\r\n        });\r\n\r\n    } catch (error: any) {\r\n        console.error('Update supplier error:', error);\r\n        res.status(500).json({\r\n            error: 'Failed to update profile',\r\n            details: error.message\r\n        });\r\n    }\r\n});\r\n\r\n// Add/Update supplier products\r\nrouter.post('/suppliers/products', authenticateToken, async (req: any, res: any) => {\r\n    try {\r\n        if (req.user.userType !== 'supplier') {\r\n            return res.status(403).json({\r\n                error: 'Access denied. Suppliers only.'\r\n            });\r\n        }\r\n\r\n        const { products } = req.body;\r\n\r\n        const supplier = await Supplier.findById(req.user.userId);\r\n        if (!supplier) {\r\n            return res.status(404).json({ error: 'Supplier not found' });\r\n        }\r\n\r\n        // Add or update products\r\n        products.forEach((product: any) => {\r\n            const existingIndex = supplier.products.findIndex(\r\n                (p: any) => p.name === product.name && p.category === product.category\r\n            );\r\n\r\n            if (existingIndex >= 0) {\r\n                supplier.products[existingIndex] = { ...supplier.products[existingIndex], ...product };\r\n            } else {\r\n                supplier.products.push(product);\r\n            }\r\n        });\r\n\r\n        await supplier.save();\r\n\r\n        res.json({\r\n            message: 'Products updated successfully',\r\n            products: supplier.products\r\n        });\r\n\r\n    } catch (error: any) {\r\n        console.error('Update products error:', error);\r\n        res.status(500).json({\r\n            error: 'Failed to update products',\r\n            details: error.message\r\n        });\r\n    }\r\n});\r\n\r\n// Get supplier analytics\r\nrouter.get('/suppliers/analytics', authenticateToken, async (req: any, res: any) => {\r\n    try {\r\n        if (req.user.userType !== 'supplier') {\r\n            return res.status(403).json({\r\n                error: 'Access denied. Suppliers only.'\r\n            });\r\n        }\r\n\r\n        const { period = 'month' } = req.query;\r\n        const analytics = await Order.getSupplierAnalytics(req.user.userId, period);\r\n\r\n        res.json({\r\n            period,\r\n            analytics: analytics[0] || {\r\n                totalOrders: 0,\r\n                totalSales: 0,\r\n                totalItemsSold: 0,\r\n                averageOrderValue: 0,\r\n                pendingOrders: 0,\r\n                deliveredOrders: 0\r\n            }\r\n        });\r\n\r\n    } catch (error: any) {\r\n        console.error('Get supplier analytics error:', error);\r\n        res.status(500).json({\r\n            error: 'Failed to fetch analytics',\r\n            details: error.message\r\n        });\r\n    }\r\n});\r\n\r\n// ===============================\r\n// VENDOR ROUTES\r\n// ===============================\r\n\r\n// Get vendor profile\r\nrouter.get('/vendors/profile', authenticateToken, async (req: any, res: any) => {\r\n    try {\r\n        if (req.user.userType !== 'vendor') {\r\n            return res.status(403).json({\r\n                error: 'Access denied. Vendors only.'\r\n            });\r\n        }\r\n\r\n        const vendor = await Vendor.findById(req.user.userId)\r\n            .select('-password')\r\n            .populate('preferredSuppliers.supplierId', 'fullName businessName rating');\r\n\r\n        if (!vendor) {\r\n            return res.status(404).json({ error: 'Vendor not found' });\r\n        }\r\n\r\n        res.json(vendor);\r\n\r\n    } catch (error: any) {\r\n        console.error('Get vendor profile error:', error);\r\n        res.status(500).json({\r\n            error: 'Failed to fetch profile',\r\n            details: error.message\r\n        });\r\n    }\r\n});\r\n\r\n// Update vendor profile\r\nrouter.put('/vendors/profile', authenticateToken, async (req: any, res: any) => {\r\n    try {\r\n        if (req.user.userType !== 'vendor') {\r\n            return res.status(403).json({\r\n                error: 'Access denied. Vendors only.'\r\n            });\r\n        }\r\n\r\n        const updates = req.body;\r\n        delete updates.password; // Prevent password updates\r\n\r\n        const vendor = await Vendor.findByIdAndUpdate(\r\n            req.user.userId,\r\n            { $set: updates },\r\n            { new: true, runValidators: true }\r\n        ).select('-password');\r\n\r\n        if (!vendor) {\r\n            return res.status(404).json({ error: 'Vendor not found' });\r\n        }\r\n\r\n        res.json({\r\n            message: 'Profile updated successfully',\r\n            vendor\r\n        });\r\n\r\n    } catch (error: any) {\r\n        console.error('Update vendor error:', error);\r\n        res.status(500).json({\r\n            error: 'Failed to update profile',\r\n            details: error.message\r\n        });\r\n    }\r\n});\r\n\r\n// Get vendor analytics\r\nrouter.get('/vendors/analytics', authenticateToken, async (req: any, res: any) => {\r\n    try {\r\n        if (req.user.userType !== 'vendor') {\r\n            return res.status(403).json({\r\n                error: 'Access denied. Vendors only.'\r\n            });\r\n        }\r\n\r\n        const { period = 'month' } = req.query;\r\n\r\n        const analytics = await Order.getAnalytics(req.user.userId, period);\r\n        const vendor = await Vendor.findById(req.user.userId).select('purchaseAnalytics savings');\r\n\r\n        res.json({\r\n            period,\r\n            analytics: analytics[0] || {},\r\n            vendorMetrics: vendor ? {\r\n                purchaseAnalytics: vendor.purchaseAnalytics,\r\n                savings: vendor.savings\r\n            } : {}\r\n        });\r\n\r\n    } catch (error: any) {\r\n        console.error('Get analytics error:', error);\r\n        res.status(500).json({\r\n            error: 'Failed to fetch analytics',\r\n            details: error.message\r\n        });\r\n    }\r\n});\r\n\r\n// Update or add inventory items\r\nrouter.patch('/vendors/inventory', authenticateToken, async (req: any, res: any) => {\r\n    try {\r\n        if (req.user.userType !== 'vendor') {\r\n            return res.status(403).json({ error: 'Access denied. Vendors only.' });\r\n        }\r\n\r\n        const { product } = req.body; // { productName, category, quantity, unit, costPrice }\r\n        const vendor = await Vendor.findById(req.user.userId);\r\n\r\n        if (!vendor) {\r\n            return res.status(404).json({ error: 'Vendor not found' });\r\n        }\r\n\r\n        const itemIndex = vendor.currentInventory.findIndex(\r\n            (item: any) => item.productName === product.productName\r\n        );\r\n\r\n        if (itemIndex >= 0) {\r\n            // Update existing\r\n            vendor.currentInventory[itemIndex] = {\r\n                ...vendor.currentInventory[itemIndex].toObject(),\r\n                ...product,\r\n                purchaseDate: new Date()\r\n            };\r\n        } else {\r\n            // Add new\r\n            vendor.currentInventory.push({\r\n                ...product,\r\n                purchaseDate: new Date()\r\n            });\r\n        }\r\n\r\n        await vendor.save();\r\n        res.json({\r\n            message: 'Inventory updated successfully',\r\n            inventory: vendor.currentInventory\r\n        });\r\n    } catch (error: any) {\r\n        console.error('Update inventory error:', error);\r\n        res.status(500).json({ error: 'Failed to update inventory', details: error.message });\r\n    }\r\n});\r\n\r\n// Remove inventory item\r\nrouter.delete('/vendors/inventory/:productName', authenticateToken, async (req: any, res: any) => {\r\n    try {\r\n        if (req.user.userType !== 'vendor') {\r\n            return res.status(403).json({ error: 'Access denied. Vendors only.' });\r\n        }\r\n\r\n        const { productName } = req.params;\r\n        const vendor = await Vendor.findById(req.user.userId);\r\n\r\n        if (!vendor) {\r\n            return res.status(404).json({ error: 'Vendor not found' });\r\n        }\r\n\r\n        vendor.currentInventory = vendor.currentInventory.filter(\r\n            (item: any) => item.productName !== productName\r\n        );\r\n\r\n        await vendor.save();\r\n        res.json({\r\n            message: 'Item removed successfully',\r\n            inventory: vendor.currentInventory\r\n        });\r\n    } catch (error: any) {\r\n        console.error('Delete inventory item error:', error);\r\n        res.status(500).json({ error: 'Failed to delete item', details: error.message });\r\n    }\r\n});\r\n\r\n// ===============================\r\n// ORDER ROUTES\r\n// ===============================\r\n\r\n// Create new order\r\nrouter.post('/orders', authenticateToken, async (req: any, res: any) => {\r\n    try {\r\n        const {\r\n            supplierId,\r\n            items,\r\n            deliveryAddress,\r\n            scheduledDate,\r\n            timeSlot,\r\n            paymentMethod,\r\n            specialInstructions\r\n        } = req.body;\r\n\r\n        // Validate supplier exists\r\n        const supplier = await Supplier.findById(supplierId);\r\n        if (!supplier) {\r\n            return res.status(404).json({ error: 'Supplier not found' });\r\n        }\r\n\r\n        // Calculate totals and verify prices\r\n        let subtotal = 0;\r\n        let marketPriceTotal = 0;\r\n\r\n        const processedItems = items.map((item: any) => {\r\n            // Find the product in supplier's inventory to verify price\r\n            const supplierProduct = supplier.products.find((p: any) => p.name === item.productName);\r\n            const priceToUse = supplierProduct ? supplierProduct.pricePerUnit : item.pricePerUnit;\r\n\r\n            const total = item.quantity * priceToUse;\r\n            subtotal += total;\r\n\r\n            // Calculate market price for savings calculation\r\n            const marketPrice = supplierProduct?.marketPrice || priceToUse * 1.2; // fallback\r\n            marketPriceTotal += (item.quantity * marketPrice);\r\n\r\n            return {\r\n                ...item,\r\n                productId: supplierProduct?._id || item.productId,\r\n                pricePerUnit: priceToUse,\r\n                totalPrice: total\r\n            };\r\n        });\r\n\r\n        // Determine delivery charge\r\n        const deliveryCharge = supplier.serviceAreas.find(\r\n            (area: any) => area.pincode === deliveryAddress.pincode\r\n        )?.deliveryCharge || 0;\r\n\r\n        const totalAmount = subtotal + deliveryCharge;\r\n        const savedAmount = marketPriceTotal - subtotal;\r\n\r\n        // Create order\r\n        const order = new Order({\r\n            vendor: req.user.userId,\r\n            supplier: supplierId,\r\n            items: processedItems,\r\n            subtotal,\r\n            deliveryCharge,\r\n            totalAmount,\r\n            marketPrice: marketPriceTotal,\r\n            savedAmount,\r\n            savingsPercentage: marketPriceTotal > 0 ? ((savedAmount / marketPriceTotal) * 100).toFixed(2) : 0,\r\n            delivery: {\r\n                address: deliveryAddress,\r\n                scheduledDate: new Date(scheduledDate),\r\n                timeSlot,\r\n                deliveryCharge\r\n            },\r\n            payment: {\r\n                method: paymentMethod,\r\n                amount: totalAmount,\r\n                finalAmount: totalAmount,\r\n                status: paymentMethod === 'cash' ? 'pending' : 'completed' // Simple simulation\r\n            },\r\n            specialInstructions,\r\n            aiAssistant: {\r\n                wasOrderedByAI: req.body.isAIOrder || false\r\n            }\r\n        });\r\n\r\n        await order.save();\r\n\r\n        // Add initial tracking step\r\n        await order.addTrackingStep('pending', 'Order received', 'Order has been placed and is awaiting confirmation');\r\n\r\n        // Populate order details\r\n        const populatedOrder = await Order.findById(order._id)\r\n            .populate('vendor', 'fullName businessName phone')\r\n            .populate('supplier', 'fullName businessName phone address');\r\n\r\n        res.status(201).json({\r\n            message: 'Order created successfully',\r\n            order: populatedOrder\r\n        });\r\n\r\n    } catch (error: any) {\r\n        console.error('Create order error:', error);\r\n        res.status(500).json({\r\n            error: 'Failed to create order',\r\n            details: error.message\r\n        });\r\n    }\r\n});\r\n\r\n// Get orders for authenticated user\r\nrouter.get('/orders', authenticateToken, async (req: any, res: any) => {\r\n    try {\r\n        const { status, limit = 20, page = 1 } = req.query;\r\n\r\n        let query: any = {};\r\n\r\n        if (req.user.userType === 'vendor') {\r\n            query.vendor = req.user.userId;\r\n        } else if (req.user.userType === 'supplier') {\r\n            query.supplier = req.user.userId;\r\n        } else {\r\n            return res.status(403).json({ error: 'Access denied' });\r\n        }\r\n\r\n        if (status) {\r\n            query.status = status;\r\n        }\r\n\r\n        const orders = await Order.find(query)\r\n            .populate('vendor', 'fullName businessName phone')\r\n            .populate('supplier', 'fullName businessName phone')\r\n            .limit(parseInt(limit as string))\r\n            .skip((parseInt(page as string) - 1) * parseInt(limit as string))\r\n            .sort({ placedAt: -1 });\r\n\r\n        res.json({\r\n            orders,\r\n            pagination: {\r\n                page: parseInt(page as string),\r\n                limit: parseInt(limit as string),\r\n                total: await Order.countDocuments(query)\r\n            }\r\n        });\r\n\r\n    } catch (error: any) {\r\n        console.error('Get orders error:', error);\r\n        res.status(500).json({\r\n            error: 'Failed to fetch orders',\r\n            details: error.message\r\n        });\r\n    }\r\n});\r\n\r\n// Get specific order\r\nrouter.get('/orders/:id', authenticateToken, async (req: any, res: any) => {\r\n    try {\r\n        const order = await Order.findById(req.params.id)\r\n            .populate('vendor', 'fullName businessName phone address')\r\n            .populate('supplier', 'fullName businessName phone address');\r\n\r\n        if (!order) {\r\n            return res.status(404).json({ error: 'Order not found' });\r\n        }\r\n\r\n        // Check if user has access to this order\r\n        if (req.user.userType === 'vendor' && order.vendor._id.toString() !== req.user.userId) {\r\n            return res.status(403).json({ error: 'Access denied' });\r\n        }\r\n        if (req.user.userType === 'supplier' && order.supplier._id.toString() !== req.user.userId) {\r\n            return res.status(403).json({ error: 'Access denied' });\r\n        }\r\n\r\n        res.json(order);\r\n\r\n    } catch (error: any) {\r\n        console.error('Get order error:', error);\r\n        res.status(500).json({\r\n            error: 'Failed to fetch order',\r\n            details: error.message\r\n        });\r\n    }\r\n});\r\n\r\n// Update order status (suppliers only)\r\nrouter.patch('/orders/:id/status', authenticateToken, async (req: any, res: any) => {\r\n    try {\r\n        if (req.user.userType !== 'supplier') {\r\n            return res.status(403).json({\r\n                error: 'Access denied. Suppliers only.'\r\n            });\r\n        }\r\n\r\n        const { status, location, description } = req.body;\r\n\r\n        const order = await Order.findById(req.params.id);\r\n        if (!order) {\r\n            return res.status(404).json({ error: 'Order not found' });\r\n        }\r\n\r\n        if (order.supplier.toString() !== req.user.userId) {\r\n            return res.status(403).json({ error: 'Access denied' });\r\n        }\r\n\r\n        await order.addTrackingStep(status, location, description);\r\n\r\n        res.json({\r\n            message: 'Order status updated successfully',\r\n            order\r\n        });\r\n\r\n    } catch (error: any) {\r\n        console.error('Update order status error:', error);\r\n        res.status(500).json({\r\n            error: 'Failed to update order status',\r\n            details: error.message\r\n        });\r\n    }\r\n});\r\n\r\n// Add order rating\r\nrouter.post('/orders/:id/rating', authenticateToken, async (req: any, res: any) => {\r\n    try {\r\n        const { rating, review } = req.body;\r\n\r\n        const order = await Order.findById(req.params.id);\r\n        if (!order) {\r\n            return res.status(404).json({ error: 'Order not found' });\r\n        }\r\n\r\n        // Check access\r\n        if (req.user.userType === 'vendor' && order.vendor.toString() !== req.user.userId) {\r\n            return res.status(403).json({ error: 'Access denied' });\r\n        }\r\n\r\n        // Update rating based on user type\r\n        if (req.user.userType === 'vendor') {\r\n            order.rating.vendor = {\r\n                ...rating,\r\n                overall: rating.overall,\r\n                review,\r\n                ratedAt: new Date()\r\n            };\r\n        }\r\n\r\n        await order.save();\r\n\r\n        res.json({\r\n            message: 'Rating added successfully',\r\n            order\r\n        });\r\n\r\n    } catch (error: any) {\r\n        console.error('Add rating error:', error);\r\n        res.status(500).json({\r\n            error: 'Failed to add rating',\r\n            details: error.message\r\n        });\r\n    }\r\n});\r\n\r\n// ===============================\r\n// SEARCH & DISCOVERY ROUTES\r\n// ===============================\r\n\r\n// Search products across suppliers\r\nrouter.get('/search/products', async (req: any, res: any) => {\r\n    try {\r\n        const {\r\n            query,\r\n            category,\r\n            maxPrice,\r\n            minRating,\r\n            pincode,\r\n            limit = 20,\r\n            page = 1\r\n        } = req.query;\r\n\r\n        let matchQuery: any = {\r\n            userType: 'supplier',\r\n            isActive: true,\r\n            'products.isActive': true\r\n        };\r\n\r\n        if (category) {\r\n            matchQuery['products.category'] = category;\r\n        }\r\n\r\n        if (maxPrice) {\r\n            matchQuery['products.pricePerUnit'] = { $lte: parseFloat(maxPrice as string) };\r\n        }\r\n\r\n        if (minRating) {\r\n            matchQuery['rating.average'] = { $gte: parseFloat(minRating as string) };\r\n        }\r\n\r\n        if (pincode) {\r\n            matchQuery['serviceAreas.pincode'] = pincode;\r\n        }\r\n\r\n        if (query) {\r\n            matchQuery.$or = [\r\n                { 'products.name': { $regex: query, $options: 'i' } },\r\n                { 'products.category': { $regex: query, $options: 'i' } },\r\n                { 'businessName': { $regex: query, $options: 'i' } }\r\n            ];\r\n        }\r\n\r\n        const results = await Supplier.aggregate([\r\n            { $match: matchQuery },\r\n            { $unwind: '$products' },\r\n            { $match: { 'products.isActive': true } },\r\n            {\r\n                $project: {\r\n                    supplierName: '$fullName',\r\n                    businessName: '$businessName',\r\n                    rating: '$rating',\r\n                    trustScore: '$trustScore',\r\n                    product: '$products',\r\n                    deliveryRadius: '$deliveryRadius',\r\n                    workingHours: '$workingHours'\r\n                }\r\n            },\r\n            { $sort: { 'rating.average': -1, 'product.pricePerUnit': 1 } },\r\n            { $skip: (parseInt(page as string) - 1) * parseInt(limit as string) },\r\n            { $limit: parseInt(limit as string) }\r\n        ]);\r\n\r\n        res.json({\r\n            products: results,\r\n            pagination: {\r\n                page: parseInt(page as string),\r\n                limit: parseInt(limit as string)\r\n            }\r\n        });\r\n\r\n    } catch (error: any) {\r\n        console.error('Search products error:', error);\r\n        res.status(500).json({\r\n            error: 'Failed to search products',\r\n            details: error.message\r\n        });\r\n    }\r\n});\r\n// Base API route\r\nrouter.get('/', (req: any, res: any) => {\r\n    console.log('✅ /api route hit');\r\n    res.json({ message: 'Welcome to the BazaarBandhu API!' });\r\n});\r\n\r\n// Optional test route\r\nrouter.get('/test', (req: any, res: any) => {\r\n    res.json({ message: 'Test route is working!' });\r\n});\r\n\r\n\r\nrouter.use('/ai-chat', aiChatRoutes);\r\n\r\n// DeepSeek-R1 local model chat route\r\nrouter.use('/deepseek-chat', deepSeekChatRoutes);\r\n\r\n// Razorpay Payment Routes\r\nrouter.use('/payments', paymentRoutes);\r\n\r\nexport default router;\r\n","import express from 'express';\r\nimport cors from 'cors';\r\nimport helmet from 'helmet';\r\nimport rateLimit from 'express-rate-limit';\r\nimport compression from 'compression';\r\nimport morgan from 'morgan';\r\n// @ts-ignore\r\nimport connectDB from './config/database.js';\r\nimport 'dotenv/config';\r\n// @ts-ignore\r\nimport apiRoutes from './routes/api.js';\r\n\r\nconst app = express();\r\n\r\n// Connect to MongoDB\r\nconnectDB();\r\n\r\n// Security middleware\r\napp.use(helmet());\r\napp.use(morgan('dev'));\r\n\r\nconst allowedOrigins = [\r\n    process.env.FRONTEND_URL,\r\n    'http://localhost:3000',\r\n    'http://localhost:8080',\r\n    'http://localhost:5173',\r\n    'http://127.0.0.1:5173',\r\n    'http://localhost:5174',\r\n    'http://127.0.0.1:5174'\r\n].filter(Boolean);\r\n\r\napp.use(cors({\r\n    origin: (origin: string | undefined, callback: (err: Error | null, allow?: boolean) => void) => {\r\n        // Allow requests with no origin (like mobile apps or curl requests)\r\n        if (!origin) return callback(null, true);\r\n\r\n        // In development, be more permissive with localhost\r\n        const isLocalhost = origin.includes('localhost') || origin.includes('127.0.0.1');\r\n\r\n        if (isLocalhost || allowedOrigins.indexOf(origin) !== -1) {\r\n            return callback(null, true);\r\n        } else {\r\n            const msg = 'The CORS policy for this site does not allow access from the specified Origin.';\r\n            return callback(new Error(msg), false);\r\n        }\r\n    },\r\n    credentials: true\r\n}));\r\n\r\nconsole.log('✅ Loaded Origins:', allowedOrigins);\r\nconsole.log('🔌 Configured PORT:', process.env.PORT);\r\n\r\n// Compression middleware\r\napp.use(compression());\r\n\r\n// Body parsing middleware\r\napp.use(express.json({ limit: '10mb' }));\r\napp.use(express.urlencoded({ extended: true, limit: '10mb' }));\r\n\r\n// Rate limiting\r\nconst limiter = rateLimit({\r\n    windowMs: Number(process.env.RATE_LIMIT_WINDOW_MS) || 15 * 60 * 1000,\r\n    max: Number(process.env.RATE_LIMIT_MAX_REQUESTS) || 100,\r\n    message: {\r\n        error: 'Too many requests from this IP, please try again later.'\r\n    }\r\n});\r\napp.use('/api/', limiter);\r\n\r\n// API routes\r\napp.use('/api', apiRoutes);\r\n\r\n// Health check endpoint\r\napp.get('/health', (req: any, res: any) => {\r\n    res.status(200).json({\r\n        status: 'OK',\r\n        timestamp: new Date().toISOString(),\r\n        service: 'BazaarBandhu API'\r\n    });\r\n});\r\n\r\n// Error handling middleware\r\napp.use((err: any, req: any, res: any, next: any) => {\r\n    console.error('Error:', err);\r\n\r\n    res.status(err.status || 500).json({\r\n        error: err.message || 'Internal Server Error',\r\n        ...(process.env.NODE_ENV === 'development' && { stack: err.stack })\r\n    });\r\n});\r\n\r\n// 404 handler\r\napp.use('*', (req: any, res: any) => {\r\n    res.status(404).json({\r\n        error: 'Route not found',\r\n        path: req.originalUrl\r\n    });\r\n});\r\n\r\n\r\nexport default app;\r\n","import \"dotenv/config\";\nimport express from \"express\";\nimport cors from \"cors\";\nimport apiRoutes from \"./routes/api.js\";\nimport app from \"./app.js\";\n\nexport function createServer() {\n  return app;\n}\n","import path from \"path\";\nimport { createServer } from \"./index.js\";\nimport express from \"express\";\n\nconst app = createServer();\nconst port = process.env.PORT || 3000;\n\n// In production, serve the built SPA files\nconst __dirname = import.meta.dirname;\nconst distPath = path.join(__dirname, \"../spa\");\n\n// Serve static files\napp.use(express.static(distPath));\n\n// Handle React Router - serve index.html for all non-API routes\napp.get(\"*\", (req, res) => {\n  // Don't serve index.html for API routes\n  if (req.path.startsWith(\"/api/\") || req.path.startsWith(\"/health\")) {\n    return res.status(404).json({ error: \"API endpoint not found\" });\n  }\n\n  res.sendFile(path.join(distPath, \"index.html\"));\n});\n\napp.listen(port, () => {\n  console.log(`🚀 Fusion Starter server running on port ${port}`);\n  console.log(`📱 Frontend: http://localhost:${port}`);\n  console.log(`🔧 API: http://localhost:${port}/api`);\n});\n\n// Graceful shutdown\nprocess.on(\"SIGTERM\", () => {\n  console.log(\"🛑 Received SIGTERM, shutting down gracefully\");\n  process.exit(0);\n});\n\nprocess.on(\"SIGINT\", () => {\n  console.log(\"🛑 Received SIGINT, shutting down gracefully\");\n  process.exit(0);\n});\n"],"names":["router","__dirname","cloudinary","aiChatRoutes","deepSeekChatRoutes","paymentRoutes","app","apiRoutes"],"mappings":"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"}